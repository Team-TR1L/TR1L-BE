# =========================================================
# application.yml (base + dev/prod profiles)
# - 비밀값(URI/비번)은 환경변수로만 주입
# - MySQL 사용
# - MongoDB는 클라우드 URI 사용
# =========================================================

spring:
  application:
    name: app

  # 기본 프로필: dev
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  jackson:
    time-zone: Asia/Seoul

server:
  port: ${SERVER_PORT:8080}

logging:
  level:
    root: INFO

# ---- 공통: MongoDB (클라우드) ----
# dev/prod 모두 Mongo는 cloud URI 사용(환경변수로만)
spring:
  data:
    mongodb:
      uri: ${MONGODB_URI}

# ---- (선택) Actuator: health check, smoke test 용 ----
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: ${HEALTH_SHOW_DETAILS:never}


# =========================================================
# DEV (로컬 개발용)
# - MySQL: 로컬 PC(또는 로컬에서 docker compose로 띄운 mysql)에 localhost로 접속
# - ddl-auto: update(개발 편의)
# =========================================================
---
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${MYSQL_URL:jdbc:mysql://localhost:3306/app?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul&characterEncoding=UTF-8}
    username: ${MYSQL_USER:app}
    password: ${MYSQL_PASSWORD:apppw}

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}     # dev 기본 update
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: Asia/Seoul

logging:
  level:
    # dev에서만 필요시 켜기 (기본 OFF)
    org.hibernate.SQL: ${HIBERNATE_SQL_LOG:OFF}
    org.hibernate.type.descriptor.sql: ${HIBERNATE_TYPE_LOG:OFF}

management:
  endpoint:
    health:
      show-details: always


# =========================================================
# PROD (운영용)
# - MySQL: 보통 RDS/운영DB (환경변수 MYSQL_URL로 주입)
# - ddl-auto: validate 권장 (스키마 자동 변경 방지)
# - show-sql: false 권장
# =========================================================
---
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${MYSQL_URL}
    username: ${MYSQL_USER}
    password: ${MYSQL_PASSWORD}

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:validate}  # prod 기본 validate
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: false
        jdbc:
          time_zone: Asia/Seoul

logging:
  level:
    root: INFO
    org.hibernate.SQL: OFF
    org.hibernate.type.descriptor.sql: OFF

management:
  endpoint:
    health:
      # 운영에서는 내부 정보 노출 방지
      show-details: never
