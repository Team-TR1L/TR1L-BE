sequenceDiagram
  autonumber
  participant Job as CalculateJob(정산 배치)
  participant DB as Postgres(RDS)
  participant S1 as Step01(입력 조립/Input Build)
  participant S3 as Step03(정산 계산/Calculate)

  Job->>S1: 대상 user_id 조회
  S1->>DB: 입력 조립 쿼리 실행 (JOIN 다수: 요금제/복지/약정/부가서비스/사용량 등)
  DB-->>S1: 유저별 정산 입력 Row 반환

  S1-->>S3: 조립된 입력 전달
  S3->>DB: 계산에 필요한 추가 조회
  DB-->>S3: 계산용 데이터 반환
  S3-->>Job: 결과 저장(정산/스냅샷/상태 업데이트)
