---
title: 2026-01-12
parent: 회의록
grand_parent: TR1L (Overview)
nav_order: 20260112
---

# 2026-01-12 청구서 생성·발송 아키텍처 재정리 및 정책 모델링 확정

## 1) 개요

- **날짜** : 2026-01-12
- **참여자** :

<!-- Participants -->
<div class="tr1l-participants" aria-label="participants">
  <a class="tr1l-chip" href="https://github.com/Jsnooopy" aria-label="이재 GitHub">
    <img class="tr1l-avatar" src="https://github.com/Jsnooopy.png?size=120" alt="이재" />
    <span class="tr1l-name">이재</span>
  </a>

  <a class="tr1l-chip" href="https://github.com/tkv00" aria-label="김도연 GitHub">
    <img class="tr1l-avatar" src="https://github.com/tkv00.png?size=120" alt="김도연" />
    <span class="tr1l-name">김도연</span>
  </a>

  <a class="tr1l-chip" href="https://github.com/ChoiSeungeon" aria-label="최승언 GitHub">
    <img class="tr1l-avatar" src="https://github.com/ChoiSeungeon.png?size=120" alt="최승언" />
    <span class="tr1l-name">최승언</span>
  </a>

  <a class="tr1l-chip" href="https://github.com/bon0512" aria-label="구본문 GitHub">
    <img class="tr1l-avatar" src="https://github.com/bon0512.png?size=120" alt="구본문" />
    <span class="tr1l-name">구본문</span>
  </a>

  <a class="tr1l-chip" href="https://github.com/marulog" aria-label="박준희 GitHub">
    <img class="tr1l-avatar" src="https://github.com/marulog.png?size=120" alt="박준희" />
    <span class="tr1l-name">박준희</span>
  </a>

  <a class="tr1l-chip" href="https://github.com/cylin0201" aria-label="김원기 GitHub">
    <img class="tr1l-avatar" src="https://github.com/cylin0201.png?size=120" alt="김원기" />
    <span class="tr1l-name">김원기</span>
  </a>
</div>

<style>
  .tr1l-participants{
    display:flex; flex-wrap:wrap; gap:10px;
    align-items:center; margin:8px 0 2px;
  }
  .tr1l-chip{
    display:inline-flex; align-items:center; gap:10px;
    padding:8px 12px; border-radius:999px;
    text-decoration:none !important;
    border:1px solid rgba(127,127,127,.28);
    background:rgba(127,127,127,.10);
    backdrop-filter:saturate(140%) blur(4px);
    transition:transform .12s ease, border-color .12s ease, background .12s ease;
  }
  .tr1l-chip:hover{
    transform:translateY(-1px);
    border-color:rgba(127,127,127,.45);
    background:rgba(127,127,127,.14);
  }
  .tr1l-avatar{
    width:28px; height:28px; border-radius:50%;
    display:block; flex:0 0 auto;
    box-shadow:0 0 0 1px rgba(127,127,127,.22);
  }
  .tr1l-name{
    font-weight:650; font-size:14px;
    line-height:1; letter-spacing:-0.2px;
    color:inherit;
  }
</style>

---

## 2) 목표(Goal)
청구서 **생성·저장·발송 흐름**을 버전/정책 변경에 대응 가능한 구조로 재정리하고,  
**할인/요금제 모델링** 및 **도메인 이벤트 개편** 방향을 확정하며,  
역할 분담과 후속 액션을 정리한다.

---

## 3) 회의 주제 / Agenda
| Time | Topic | Note |
|---:|---|---|
| 10:00 | Domain Modeling | 청구서 조립/완성 도메인 분리 및 버전 관리 / Kafka 저장·흐름 및 재발송 설계 |
| 11:00 | ERD | 발송 정책(금지 시간대, 재시도, fallback) / 할인율 Table 처리 vs 비즈니스 로직 처리 |

---

## 4) 회의 내용(Notes)

### 4.1 청구서 조립 배치 분리 및 버전 관리
- **정산 배치(계산/적재)**와 **청구서 완성(템플릿 조립/파일 생성)**을 분리하는 방향 논의
- 배치가 산출한 정제 데이터를 기반으로 청구서를 완성하는 도메인을 별도 분리하면,
  - 청구서 템플릿/버전 변경 시 **배치를 다시 돌리지 않고도** 재조립/재생성 가능
- 완성된 청구서는 **S3 저장**을 전제로 하며,
  - 보관 비용 이슈는 **TTL/주기적 삭제 정책**으로 관리

---

### 4.2 정책 변경 대비 저장 전략(이메일/SNS/S3 등)
- 플랫폼 정책이 변경될 수 있으므로, **한 번 생성한 결과를 재활용**할 수 있는 구조가 필요
- 청구 데이터 규모(예: 500만) 기준으로 이메일/SNS/청구서 파일 등 파생 데이터가 커질 수 있어,
  - “무조건 미리 생성” vs “필요 시 생성”의 trade-off 논의
- 결론:
  - **실패 건만** 후속 도메인으로 보내 재처리(재발송 시점 포함)
  - **청구서/템플릿 완성 도메인**에서 최종 생성 및 저장을 담당하는 구조가 합리적

---

### 4.3 Kafka를 저장소처럼 쓰는 것에 대한 정리
- Kafka 토픽에 쌓이는 이벤트가
  - 완성 청구서 데이터인지
  - 청구서 생성에 필요한 원천 데이터인지
  경계 정의가 중요함
- 결론:
  - 완성본 파일 저장은 **S3가 적합**
  - Kafka는 **흐름 전달/비동기 처리**에 집중하는 방향이 명확
- S3 기반 데이터 활용 시
  - 조회가 필요하면 **S3 Query / 메타데이터 관리** 등 조회 전략 필요 인지

---

### 4.4 발송 정책/실패 처리(재시도, SMS fallback)
- 발송 실패 시나리오에서 **실패한 것만 이벤트로 전달**하여 후속 처리를 단순화
- 이메일 최종 실패 후 SMS fallback은 “최종 실패” 정의(재시도 소진 등)가 필요하므로
  - **Policy로 명확히 모델링** 필요
- 금지 시간대(Do-not-disturb) 등 정책도
  - 큐 적재/지연 발송 방식까지 포함해 **Policy로 정리**하는 방향 논의

---

### 4.5 도메인 모델 확장 및 이벤트 개편 필요
- 현재 도메인 이벤트는 **대대적 개편 필요**하다는 점 공유
- 시간이 촉박하므로
  - **빠르게 모델 확정 → ERD 확정** 흐름으로 진행
- 역할 분담(피드백 흐름) 구체화
  - **청구서/정산 도메인**: 박준희, 구본문 중심 확인 및 피드백
  - **발송 정책/플랫폼 도메인**: 김원기, 최승언 중심 확인 및 피드백
  - 최종 취합/정리: 김도연에게 전달하여 확정

---

### 4.6 요금제/부가서비스/복지 할인 모델링 논의
- 요금제에 부가서비스를
  - 매핑 테이블로 둘지
  - 단순 정수 컬럼으로 둘지 논의
- 요금제 증가/변경 시 코드 수정이 잦아질 수 있는 리스크 인지
- 부가서비스의 가격/종류가 늘어날 수 있으면
  - DB 테이블로 분리해 확장성을 확보하는 방향이 유리하다는 관점 공유
- 복지 할인
  - 실무 프로세스 특성상(매장 처리 등) “적합성 판정”을 모델에 과도하게 넣기보다
  - 적용 여부/상태 중심으로 단순화하는 방향 검토
- 선택약정 할인(25%)
  - 단일 값으로 관리 가능
  - 시작/종료일 필수
- 가족 결합
  - 구성원 변동/해지일 관리 필요
  - 대표자 이탈 여부에 따라 결합 유지 규칙이 달라짐(규칙 확인 필요)

---

### 4.7 Entity 저장 방식(도메인 모델 반영) 논의
- 시간 제약상 Entity(저장/전송용 구조)와 도메인 모델을 별도로 두고 래퍼를 만드는 방식은 비용이 큼
  - 래퍼 + 테스트 부담 증가
- 결론:
  - **도메인 모델 자체를 Entity 구조로 가져가는 방향**을 검토/결정

---

### 4.8 회의록 작성 방식 정리
- 회의 중 생기는 의문/멘토 질문 후보를 각자 수시로 적재해두고, **회의 전에 공유**
- 회의록에는
  - 내가 한 일 / 할 일 / 협업 요청을 미리 적어두면
  - 회의 효율이 올라간다는 점 합의

---

## 5) 조치 항목(Action Items)
- [ ] 도메인 이벤트 개편안 초안 작성
- [ ] 청구서 완성 도메인 분리 설계 정리
- [ ] 발송 정책(재시도 / 최종 실패 / SMS fallback / 금지 시간대) Policy 정리
- [ ] 요금제 / 부가서비스 / 할인(복지 / 선택 약정 / 가족 결합) 모델링 피드백
- [ ] ERD 확정 준비
- [ ] 멘토 질문 리스트 사전 정리
